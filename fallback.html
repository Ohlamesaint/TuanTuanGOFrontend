<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./app.js"></script>
</head>
<body>
    <button class="enable-notification">允許推播</button>
    <script>
        let enableNotifications = document.querySelectorAll('.enable-notification');
        
        if('Notification' in window) {
            for(let i=0; i<enableNotifications.length; i++){
                enableNotifications[i].style.display = 'inline-block';
                enableNotifications[i].addEventListener('click', askForNotificationPermission);
            }
        }
        
        function askForNotificationPermission() {
            Notification.requestPermission((status) => {
                console.log('User choice', status);
                if(status!=='granted'){
                    console.log('user denied');
                } else {
                    displayNotification();
                }
            })
        }
        
        function displayNotification() {
            if('serviceWorker' in navigator){
                var options = {
                    body: '團購中的訊息',
                    icon: './public/img/tuantuango196.png',
                    dir: 'ltr',
                    lang: 'zh-Hant',
                    vibrate: [100, 50, 200],
                    badge: './public/img/tuantuango196.png',
                    tag: 'confirm-notification',
                    renotify: true,
                    actions: [{
                        actions: 'confirm', title: '確認'
                    },{
                        actions: 'cancel', title: '取消'
                    }]
                };
                navigator.serviceWorker.ready
                .then((sw) => {
                    sw.showNotification('訂閱成功', options);
                })
            }
        }
    </script>
    
</body>
</html>